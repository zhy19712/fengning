{include file="../app/public/common_header.html"}
<script src="__PUBLIC__/jquery/jquery.min.js"></script>
    <style>
        #tableContent{
            overflow: auto;
        }
        #tableContent .dataTables_wrapper, .tbcontainer{
            display: block;
        }
        #tableContent .mybtn,#tableContent .assModel,#tableContent .move,#tableContent .file,#tableContent .oneKeyArchiv{
            float: right;
            background-color: #00c0ef;
        }
        #tableContent .dataTables_wrapper {
            position: relative;
            clear: both;
            zoom: 1;
            overflow: auto;
        }
        #tableContent table{
            width: 800px;
        }
        table td{word-break:break-all;}

        table{table-layout:fixed;}

        #tableContent .select-color {
            background-color: #FDD5B5 !important;
        }
    </style>
<div id="tableContent" data-options="region:'center',title:''" style="padding:5px;background:#ffffff;">
    <table id="tableItemChose" class="table table-striped table-bordered" cellspacing="0"  width="100%">
        <thead>
        <tr>
            <th>选择</th>
            <th>模版编号</th>
            <th>模版名称</th>
            <th>表格类型</th>
            <th>表格用途</th>
        </tr>
        </thead>
    </table>
    <div class="tbcontainer">
        <div class="mark"></div>
    </div>
</div>

{include file="../app/public/common_footer.html"}
<script>

    //组织结构表格
    var tableItemChose = $('#tableItemChose').DataTable({
        pagingType: "full_numbers",
        processing: true,
        "scrollY": "336px",
        "scrollCollapse": "true",
        "paging": "false",
        serverSide: true,
        ajax: {
            "url":"{:url('/standard/common/datatablesPre')}?tableName=quality_template"
        },
        dom: 'lf<"mybtn layui-btn layui-btn-sm">rtip',
        columns: [
            {
                name: "id"
            },
            {
                name: "code"
            },
            {
                name: "name"
            },
            {
                name: "type"
            },
            {
                name: "use"
            }
        ],
        columnDefs: [
            {
                targets: [0],
                "searchable": false,
                "orderable": false,
                width:'50px',
                "render": function (data, type, row) {
                    var a = data;
                    var html = "<a type='button' href='javasrcipt:;' class=''>" +
                        "<input type='radio' name='sex' class='sex' checked onclick='checkFile("+row[0]+")'>" +
                        "</a>";
                    return html;
                }
            },
            {
                "searchable": false,
                "orderable": false,
                "targets": [1],
                width:'150px'
            },
            {
                "searchable": false,
                "orderable": false,
                "targets": [2],
                width:'150px'
            },
            {
                "searchable": false,
                "orderable": false,
                "targets": [3],
                render: function (data, type, row) {
                    if (data == 1) {
                        return "质量";
                    }else if(data == 2){
                        return "其他";
                    }
                }
            },
            {
                "searchable": false,
                "orderable": false,
                "targets": [4],
                render: function (data, type, row) {
                    if (data == 1) {
                        return "单元工程质量评定表";
                    }else if(data == 2){
                        return "分部工程质量评定表";
                    }else if(data == 3){
                        return "单位工程质量评定表";
                    }
                }
            }
        ],
        language: {
            "lengthMenu": "_MENU_",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "sFirst": "<<",
                "sPrevious": "<",
                "sNext": ">",
                "sLast": ">>"
            }
        },
        "fnInitComplete": function (oSettings, json) {
            $('#tableItemChose_length').insertBefore(".mark");
            $('#tableItemChose_info').insertBefore(".mark");
            $('#tableItemChose_paginate').insertBefore(".mark");
        }
    });
    //保存
    $(".mybtn").html("<div id='test3'>保存</div>");

    var form;
    layui.use(['form', 'layedit', 'laydate'], function () {
        form = layui.form;
        var layer = layui.layer;

        form.on('select()', function(data){
            // console.log(data.value); //得到被选中的值
            if(data.value == 1){
                $("#modelList").css("display",'block');
            }else if(data.value == 0){
                $("#modelList").css("display",'none');
            }
        });

        function closWin() {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        };

        function refreshSub() {
            parent.tableItemChose.ajax.url("{:url('/standard/common/datatablesPre')}?tableName=quality_template").load();
        }
        //监听提交
        form.on('submit(demo1)', function (data) {
            console.log($("#addId").val());
            console.log(data);
            if ($("#addId").val() == '') {
                $.ajax({
                    type: "Post",
                    url: "{:url('templatemanage/add')}",
                    data: data.field,
                    success: function (res) {
                        console.log(res)
                        if (res.code == 1) {
                            refreshSub();
                            parent.layer.msg('保存成功！');
                            closWin();
                        }
                    },
                    error: function (data) {
                        debugger;
                    }
                })
            } else if ($("#addId").val() != '') {

                $.ajax({
                    type: "Post",
                    url: "{:url('add')}",
                    data: data.field,
                    success: function (res) {
                        console.log(res)
                        if (res.code == 1) {
                            refreshSub();
                            parent.layer.msg('编辑成功！');
                            closWin();
                            form.render('select');
                        }
                    },
                    error: function (data) {
                        debugger;
                    }
                })

            }
            return false;
        });
        $('button[type="reset"]').click(function () {
            closWin();
        })
    });

    //驱虫
    Array.prototype.removal = function(){
        var newArr = [];
        for (var i = 0; i < this.length; i++) {
            if(newArr.indexOf(this[i]) == -1){
                newArr.push(this[i]);
            }
        }
        return newArr;
    }
    //删除数组中的指定元素
    Array.prototype.remove = function(val){
        for (var i = 0; i < this.length; i++) {
            if(this[i] === val){
                this.splice(i,1);
                break;
            }
        }
        return this;
    }
    var dataArr=[];
    //获取选中行ID
    function getDataId(that) {
        var isChecked = $(that).prop('checked');
        var id = $(that).parents('tr').find('td:eq(1)').text();
        if(isChecked){
            dataArr.push(id);
            dataArr.removal(id);
        }else {
            dataArr.remove(id);
            dataArr.removal(id);
        }
        console.log(dataArr)
    }
    //单选
    function getRadioId(that) {
        getDataId(that);
        console.log(dataArr);
    }

    function checkFile(id) {
        console.log(id);
        var that = this;
            console.log($(that).html());
            debugger;
        if($(this).checked){
            alert(2423)
        }
    };

    $("#tableItemChose").delegate("tbody tr","click",function (e) {
        if($(e.target).hasClass("dataTables_empty")){
            return;
        }
        $(this).addClass("select-color").siblings().removeClass("select-color");
        selectData = tableItemChose.row(".select-color").data();//获取选中行数据
    });
</script>
</html>