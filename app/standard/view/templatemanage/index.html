{include file="../app/public/common_header.html"}
<script src="__PUBLIC__/jquery/jquery.min.js"></script>
<style>

    .panel{
        top: 96px;
    }
    #queryCriteria{
        width: 100%;
        height: 90px;
        /*border: 1px dotted #00c0ef;*/
    }
    #queryCriteria .title{
        margin-left: 10px;
        margin-top: 5px;
    }
    #queryCriteria .selectItem{
        margin-left: 250px;
        margin-top: 30px;
        position: relative;
    }
    #queryCriteria .selectItem .layui-select-title{
        width: 400px;
    }
    #queryCriteria .sea{
        position: absolute;
        right: 1%;
        /*top: -62%;*/
        top: 0%;
    }
    #queryCriteria .sea button{
        background-color: #00c0ef;
        color: #FFFFFF;
    }

    #tableContent .mybtn i.fa:before,#tableContent .assModel i.fa:before,#tableContent .move i.fa:before,#tableContent .file i.fa:before,#tableContent .oneKeyArchiv i.fa:before {
        background: #00c0ef;
        color: #ffffff;
    }
    #tableContent .mybtn,#tableContent .assModel,#tableContent .move,#tableContent .file,#tableContent .oneKeyArchiv{
        float: right;
        background-color: #00c0ef;
    }
    #tableContent .mybtn{
        margin-right: 0%;
        margin-bottom: 5px;
    }
    #tableContent .assModel{
        margin-right: 0%;
        margin-bottom: 5px;
    }
    #tableContent .move{
        margin-right: 0%;
        margin-left: 10px;
        margin-bottom: 5px;
    }
    #tableContent table.dataTable.no-footer {
        border-top: 1px dotted;
    }
    #tableContent #funKuai{
        width: 100%;
        position: absolute;
        left: 72%;
    }
    #tableContent #funKuai>span{
        background-color: #00c0ef;
        margin-left: 5px;
        color: #FFFFFF;
    }
    #tableContent #funKuai>span i.fa:before {
        padding-right: 3px;
        color: #FFFFFF;
    }
    #tableContent #tableItem_filter {
        float: left;
    }
    #tableContent .select-color {
        background-color: #FDD5B5 !important;
    }
    #tableContent h3 {
        margin-top: 5px;
        font-weight: 600;
        font-size: 16px;
        display: inline-block;
    }
    #tableContent .ibox-tools {
        float: right;
        margin-right: 30px;
        margin-top: 10px;
    }
    #tableContent .ibox-tools2 {
        float: right;
        margin-right: 15px;
    }
    #tableContent .dataTables_wrapper .dataTables_scroll {
        position: relative;
        top: 15px;
        border-top: 1px dotted #cecece;
    }
    #tableContent #tableItem tr td a{
        color: #337ab7;
    }
    #tableContent .dataTables_wrapper,#tableContent .tbcontainer{
        display: block;
    }
    #tableContent .tableHeadName{
        width: 100%;
        font-size: 14px;
        font-weight: 800;
        color: #0E2D5F;
        height: 22px;
        padding: 5px;
        border-bottom: 1px solid #cecece;
        line-height: 22px;
        border-top: 1px solid #cecece ;
        margin: 4px 0 4px -5px;
    }

</style>

<!--<div id="bodyBig">-->
<div id="tableContent" data-options="region:'center',title:'查询条件'" style="padding:5px;background:#ffffff;">
    <div id="queryCriteria">
        <div class="title"></div>
        <div class="selectItem">
            <form class="layui-form" action="">
                <div class="layui-inline">
                    <label class="layui-form-label">表格类型</label>
                    <div class="layui-input-inline">
                        <select name="type">
                            <option value="">-请选择-</option>
                            <option value="1">质量</option>
                            <option value="2">其他</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">表格用途</label>
                    <div class="layui-input-block">
                        <select name="use" lay-verify="">
                            <option value="">-请选择-</option>
                            <option value="1">单元工程质量评定表</option>
                            <option value="2">分部工程质量评定表</option>
                            <option value="3">单位工程质量评定表</option>
                        </select>
                    </div>
                </div>
                <div class="sea">
                    <button class="layui-btn" lay-submit="" lay-filter="demo1">查询</button>
                </div>
            </form>
        </div>
    </div>
    <div class="tableHeadName">模版信息列表</div>
    <table id="tableItem" class="table table-striped table-bordered" cellspacing="0"  width="100%">
        <thead>
            <tr>
                <th>模版编号</th>
                <th>模版名称</th>
                <th>表格类型</th>
                <th>表格用途</th>
                <th>操作</th>
            </tr>
        </thead>
    </table>
    <div class="tbcontainer">
        <div class="mark"></div>
    </div>
</div>
<!--</div>-->

{include file="../app/public/common_footer.html"}
<!--<script src="__WEBSITE__/archive/document/index.js"></script>-->
</body>
<script type="text/javascript">

    //组织结构表格
    var tableItem = $('#tableItem').DataTable({
        pagingType: "full_numbers",
        processing: true,
        serverSide: true,
        ajax: {
            "url":"{:url('/standard/common/datatablesPre')}?tableName=quality_template"
        },
        dom: '<"mybtn layui-btn layui-btn-sm">rtip',
        columns: [
            {
                name: "code"
            },
            {
                name: "name"
            },
            {
                name: "type"
            },
            {
                name: "use"
            },
            {
                name: "id"
            }
        ],
        columnDefs: [
            {
                "searchable": false,
                targets:[2],
                render: function (data, type, row) {
                    if (data == 1) {
                        return "质量";
                    }else if(data == 2){
                        return "其他";
                    }
                }
            },
            {
                targets: [0],
            },
            {
                "searchable": false,
                "orderable": false,
                "targets": [4],
                "render": function (data, type, row) {
                    var a = data;
                    var html = "<a type='button' href='javasrcipt:;' class='' style='margin-left: 5px;' onclick='editFile("+row[4]+")'><i title='编辑' class='fa fa-pencil'></i></a>";
                    html += "<a type='button' class='' style='margin-left: 5px;' onclick='delFile("+row[4]+")'><i title='删除' class='fa fa-trash'></i></a>";
                    return html;
                }
            },
            {
                "searchable": false,
                targets: [3],
                render: function (data, type, row) {
                    if (data == 1) {
                        return "单元工程质量评定表";
                    }else if(data == 2){
                        return "分部工程质量评定表";
                    }else if(data == 3){
                        return "单位工程质量评定表";
                    }
                }
            }
        ],
        language: {
            "lengthMenu": "_MENU_",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "sFirst": "<<",
                "sPrevious": "<",
                "sNext": ">",
                "sLast": ">>"
            }
        },
        "fnInitComplete": function (oSettings, json) {
            $('#tableItem_length').insertBefore(".mark");
            $('#tableItem_info').insertBefore(".mark");
            $('#tableItem_paginate').insertBefore(".mark");
        }
    });

    //点击上传文件
    $(".mybtn").html("<div id='test3'><i class='fa fa-plus'></i>新增模板</div>");

    var layer = layui.layer;
    //查询提交
    layui.use(['form', 'layedit', 'laydate','layer'], function(){
        var form = layui.form
            ,layer = layui.layer;
        //监听提交
        form.on('submit(demo1)', function(data){
            tableItem.ajax.url("{:url('/standard/common/datatablesPre')}?tableName=quality_template&type="+data.field.type+"&use="+data.field.use).load();
            return false;
        });
    });

    //点击新增模板
    $("#tableContent .mybtn").click(function () {
        layer.open({
            type: 2,
            title: '新增模板',
            shadeClose: true,
            area: ['780px', '550px'],
            content: '{:url("add")}',
        });
    });

    //点击编辑模板
    function editFile(id) {
        layer.open({
            type: 2,
            title: '编辑模板',
            shadeClose: true,
            area: ['780px', '550px'],
            content: '{:url("add")}?id='+id
            // end:function () {
            //     tableItem.ajax.url("{:url('contract/common/datatablesPre?tableName=contract')}").load();
            // }
        });
    };

    //点击删除模板
    function delFile(id) {
        layer.confirm('该操作会将数据删除，是否确认删除？', function(index){
            console.log(id);
            $.ajax({
                type: "post",
                url: "{:url('templatemanage/del')}",
                data: {id: id},
                success: function (res) {
                    if(res.code == 1){
                        console.log(res)
                        layer.msg("删除成功！")
                        tableItem.ajax.url("{:url('/standard/common/datatablesPre')}?tableName=quality_template").load();
                    }else if(res.code==0){
                        layer.msg(res.msg);
                    }
                },
                error: function (data) {
                    debugger;
                }
            })
            layer.close(index);
        });
    };

</script>
</html>