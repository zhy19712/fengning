<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>fengning_main</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="__PUBLIC__/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__PUBLIC__/layui/css/modules/layer/default/layer.css" media="all">
    <link rel="stylesheet" href="__PUBLIC__/font-awesome/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="__PUBLIC__/jquery/jquery.min.js"></script>
    <script type="text/javascript" charset="utf8" src="__PUBLIC__/layui/lay/modules/layer.js"></script>
    <script type="text/javascript" charset="utf8" src="__PUBLIC__/layui/layui.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js"></script>
    <style type="text/css">
        body{
            /*height: 834px;*/
            /*border: 1px dotted #cecece;*/
            background: #ffffff;
            /*border-bottom: none;*/
        }
        #secTable #path{
            line-height: 30px;
            font-weight: 800;
            font-size: 14px;
            border-bottom: 1px dotted #cecece;
        }
        #secTable #spanPath{
            display: inline-block;
            float: left;
        }
        #secTable .dataTables_filter label{
            font-size: 12px;
            font-weight: 800;
        }
        #secTable #mytable1_wrapper th{
            font-size: 12px;
        }
        #secTable #mytable1_wrapper{
            position: relative;
            margin-top: 10px;
        }
        #secTable .mybtn{
            position: absolute;
            right: 1%;
            top: -5px;
        }
        #secTable .float_left{
            float: left;
            margin-bottom: 4px;
        }
        #secTable .float_left input:focus{
            border-color: #9ac6ff;
        }
        #secTable #mytable1_wrapper .dataTables_wrapper {
            position: relative;
            clear: both;
            zoom: 1;
            overflow-x: auto;
        }
        #secTable #mytable1_wrapper table{
            /*border-top: 1px solid #00c0ef;*/
            margin-top: 12px;
        }
        #secTable table {
            table-layout:fixed;
        }
        #secTable table td{
            word-break:break-all;
        }
        #secTable .highlight {
            background: #FDD5B5 !important;
        }
        #secTable .dataTables_wrapper .dataTables_paginate {
            position: fixed;
            bottom: -5px;
            left: 260px;
            z-index: 4;
        }
        #secTable .dataTables_wrapper .dataTables_info {
            position: fixed;
            bottom: 4px;
            left: 94px;
            z-index: 4;
        }
        #secTable .dataTables_length{
            height: 8px;
            position: fixed;
            bottom: 14px;
            left: 19px;
            z-index: 4;
        }
        #secTable .dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
            color: #333 !important;
            border: none;
            background: white;
        }
        #secTable #admin_table .odd{
            background-color: #f9f9f9;
        }
        #secTable #admin_table .even{
            background-color: white;
        }
        #secTable .layui-btn{
            background-color: #00c0ef;
        }
        #secTable .fa-pencil:before, .fa-trash:before {
            color: #00c0ef;
            outline: none;
        }
        #secTable .xia{
            width: 100%;
            height: 26px;
            background: white;
            position: fixed;
            bottom: 0;
            left: 0;
            padding-top: -3px;
        }
        #secTable .dataTables_scroll{
            /*border: 1px dotted #cecece;*/
            /*border-bottom:none;*/
        }
        #secTable .layui-btn-sm {
            height: 28px;
            line-height: 34px;
            padding: 0 10px;
            font-size: 12px;
        }
        #secTable #mytable1_wrapper thead th{
            border-top: 1px dotted #cecece;
        }
        #memberAdd{
            margin-top: 10px;
        }
        #memberAdd .layui-form-label{
            width: 100px;
            padding: 5px 15px;
        }
        #memberAdd .layui-form-item .layui-input-inline{
            width: 200px;
        }
        #memberAdd .layui-form-item {
            margin-bottom: 8px;
        }
        #memberAdd .layui-form-item .layui-input {
            width: 88%;
        }
        #memberAdd .layui-form-select .layui-edge{
            right: 66px;
        }
        #memberAdd .layui-form-select .layui-input{
            width: 75%;
        }
        #memberAdd .layui-form-select dl {
            left: 144px;
            min-width: 75%;
        }
        /*#memberAdd .layui-form-select dl dd.layui-this {*/
        /*background-color: white;*/
        /*color: #000000;*/
        /*}*/
        #memberAdd .borForm{
            border: 1px solid #0d77b6;
            position: relative;
            margin: 0px 15px 10px 15px;
            padding-top:9px;
        }
        #memberAdd .borForm .bgSpan{
            position: absolute;
            background:white;
            top: -10px;
            left: 5px;
        }
        #memberAdd .layui-form-label {
            width: 114px;
        }
        #memberAdd #contractId option{
            display: block;
            height: 100px;
        }
        #memberAdd ul li{
            border: 1px solid;
            margin: 5px;
            height: 32px;
            width: 545px;
            margin-left: 33px;
            text-align: center;
        }
        #memberAdd #opi{
            display: none;
            z-index: 7;
        }
    </style>
<body class="easyui-layout" style="overflow-y:hidden;">
<!--表格-->
<div id="secTable" class="wrapper wrapper-content animated fadeInRight" style="width: 99.5%;vertical-align: top;padding: 0;margin-left: 4px;text-align: center">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <div class="row">
                <div id="path"><span id="spanPath">标段管理</span><div style="clear: both;"></div></div>
                <div id="mytable1_wrapper">
                    <table id="admin_table" width="100%" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>标段编码</th>
                                <th>标段名称</th>
                                <th>合同金额（万元）</th>
                                <th>业主单位</th>
                                <th>施工单位</th>
                                <th>设计单位</th>
                                <th>监理单位</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="xia"></div>
        </div>
    </div>
</div>

</body>
<script type="text/javascript">

    var adminId;
    var admin_table = $('#admin_table').DataTable({
        pagingType: "full_numbers",
        processing: true,
        serverSide: true,
        // sScrollY:'710px',
        // sScrollX:'960px',
        ajax: {
            url:"{:url('contract/common/datatablesPre?tableName=section')}"
        },
        dom: '<"mybtn layui-btn layui-btn-sm"><"selectyear"><"myl"l><"float_left"f>tip',
        columns:[
            {
                name: "code"
            },
            {
                name: "name"
            },
            {
                name: "money"
            },
            {
                name: "builder"
            },
            {
                name: "constructor"
            },
            {
                name: "designer"
            },
            {
                name: "supervisor"
            },
            {
                name: "id"
            }
        ],
        columnDefs: [
            {
                searchable: false,
                orderable: false,
                targets: [7],
                render :  function(data,type,row) {
                    // console.log(adminId)
                    // console.log(row.pop())
                    var html =  "<a class='tt' style='margin-left: 5px;' onclick='secEdit(this)'><i class='fa fa-pencil' title='编辑'></i></a >" ;
                    html += "<a  class='' style='margin-left: 5px;' onclick='secDel(this)'><i class='fa fa-trash' title='删除'></i></a>" ;
                    return html;
                }
            },
        ],
        language: {
            "lengthMenu": "_MENU_ ",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "sFirst": "<<",
                "sPrevious": "<",
                "sNext": ">",
                "sLast": ">>"
            }
        }
    });
    // console.log(admin_table.row('.tt').data());
    // adminId = admin_table.row
    $("div.mybtn").html('<div><i class="fa fa-plus"></i>&nbsp;新增</div>');
    //变色
    $('#admin_table tbody').on( 'mouseover', 'td', function () {
            $(this).parent("tr").addClass('highlight');
        }).on( 'mouseleave', 'td', function () {
            $(this).parent("tr").removeClass( 'highlight' );
    });
    //新增
    $("#admin_table_wrapper .mybtn").click(function () {
        layer.open({
            type: 2,
            title: '新增标段',
            shadeClose: true,
            area: ['780px', '560px'],
            content: '{:url("add")}',
        });
    })
    //编辑
    function secEdit(that){
        // console.log(admin_table.row(".highlight").data()[7]);
        var id = admin_table.row(".highlight").data()[7];
        console.log(id)
        layer.open({
            type: 2,
            title: '编辑标段',
            shadeClose: true,
            area: ['780px', '560px'],
            content: '{:url("add")}',
            success:function (layero,index) {
                var body = layer.getChildFrame('body', index);
                body.find("#addId").val(id);
            }
            // success: function(layero, index){
            //     var laysrc = layer.getChildFrame('#nameLay', index);
            //     var body = layer.getChildFrame('body', index);
            //     var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();
            //     console.log(iframeWin);
            //     debugger;
            //     // $(select).val(option[value]);
            //     // layui.form().render('select');
            //     var bodyOrgs = body.find('#_orgs').val();
            //     var jsOrgs=JSON.parse(bodyOrgs);
            //     console.log(jsOrgs);
            //     for(var i=0;i<jsOrgs.length;i++){
            //         // console.log(jsOrgs[i].id + 'id')
            //         // console.log(res.builderId +'builderId')
            //         if(jsOrgs[i].id == res.builderId){
            //             // body.find('select[name="builderId"] option:selected').text(jsOrgs[i].name);
            //             // body.find('.layui-select-tips').attr('lay-value',jsOrgs[i].id);
            //             // body.find('select[name="builderId"]').val(jsOrgs[i].name);
            //             // body.find('.layui-select-tips').after($("<dd/>").text(jsOrgs[i].name).attr({"lay-value": jsOrgs[i].id}));
            //             body.find('.layui-select-tips').append($("<option/>").text(jsOrgs[i].name).attr({"lay-value": jsOrgs[i].id}));
            //         }else if(jsOrgs[i].id == res.supervisorId){
            //             body.find('select[name="supervisorId"]').next().find("input").val(jsOrgs[i].name);
            //             // body.find('select[name="supervisorId"]').val(jsOrgs[i].id);
            //             body.find('.layui-select-tips').attr('lay-value',jsOrgs[i].id);
            //             // debugger;
            //             // body.find("#supervisorId").append($("<option/>").text(jsOrgs[i].name).attr({"value": jsOrgs[i].id}));
            //         }else if(jsOrgs[i].id == res.designerId){
            //             body.find('select[name="designerId"]').next().find("input").val(jsOrgs[i].name);
            //             // body.find('select[name="designerId"]').val(jsOrgs[i].id);
            //             body.find('.layui-select-tips').attr('lay-value',jsOrgs[i].id);
            //             // body.find("#designerId").append($("<option/>").text(jsOrgs[i].name).attr({"value": jsOrgs[i].id}));
            //         }else if(jsOrgs[i].id == res.constructorId){
            //             body.find('#constructorId').next().find("input").val(jsOrgs[i].name);
            //             // body.find('#constructorId').val(jsOrgs[i].id);
            //             body.find('.layui-select-tips').attr('lay-value',jsOrgs[i].id);
            //             // body.find("#constructorId").append($("<option/>").text(jsOrgs[i].name).attr({"value": jsOrgs[i].id}));
            //         }else if(jsOrgs[i].id == res.otherId){
            //             body.find('select[name="otherId"]').next().find("input").val(jsOrgs[i].name);
            //             // body.find('select[name="otherId"]').val(jsOrgs[i].id);
            //             body.find('.layui-select-tips').attr('lay-value',jsOrgs[i].id);
            //             // body.find("#otherId").append($("<option/>").text(jsOrgs[i].name).attr({"value": jsOrgs[i].id}));
            //         }
            //     }
            //     body.find('input[name="id"]').val(res.id);
            //     body.find('input[name="code"]').val(res.code);
            //     body.find('input[name="shortName"]').val(res.shortName);
            //     body.find('input[name="money"]').val(res.money);
            //     body.find('input[name="name"]').val(res.name);
            //     body.find('input[name="contractId"]').val(res.contractId);
            // },
            // // content:'<form class="layui-form" name="memberAdd" id="memberAdd" method="post"  action="#" onsubmit="return false">\n' +
            // // '                    <input type="hidden" name="id" id="addId" style="display: none;">\n' +
            // // '                    <div class="borForm">\n' +
            // // '                        <span class="bgSpan">基础信息</span>\n' +
            // // '                        <div class="layui-form-item">\n' +
            // // '                            <label class="layui-form-label">标段编码</label>\n' +
            // // '                            <div class="layui-input-inline">\n' +
            // // '                                <input type="text" name="code" placeholder="合同名称" lay-verify="required" autocomplete="off" class="layui-input">\n' +
            // // '                            </div>\n' +
            // // '                        </div>\n' +
            // // '                        <div class="layui-form-item">\n' +
            // // '                            <div class="layui-inline">\n' +
            // // '                                <label class="layui-form-label">标段简称</label>\n' +
            // // '                                <div class="layui-input-inline">\n' +
            // // '                                    <input type="text" name="shortName" placeholder="合同编号" lay-verify="required" autocomplete="off" class="layui-input">\n' +
            // // '                                </div>\n' +
            // // '                            </div>\n' +
            // // '                            <div class="layui-inline">\n' +
            // // '                                <label class="layui-form-label">合同金额</label>\n' +
            // // '                                <div class="layui-input-inline">\n' +
            // // '                                    <input type="text" name="money" placeholder="合同名称" lay-verify="required" autocomplete="off" class="layui-input">\n' +
            // // '                                </div>\n' +
            // // '                            </div>\n' +
            // // '                        </div>\n' +
            // // '                        <div class="layui-form-item">\n' +
            // // '                            <label class="layui-form-label">标段名称</label>\n' +
            // // '                            <div class="layui-input-block" class="inpLength">\n' +
            // // '                                <input type="text" name="name" lay-verify="title" autocomplete="off" placeholder="请输入标段名称" class="layui-input">\n' +
            // // '                            </div>\n' +
            // // '                        </div>\n' +
            // // '                        <div class="layui-form-item">\n' +
            // // '                            <label class="layui-form-label">所属合同</label>\n' +
            // // '                            <select name="contractId" id="contractId">\n' +
            // // '                            </select>\n' +
            // // '                        </div>\n' +
            // // '                    </div>\n' +
            // // '                    <!--业主现场管理机构-->\n' +
            // // '                    <div class="borForm">\n' +
            // // '                        <span class="bgSpan">管理配置</span>\n' +
            // // '                        <div class="layui-form-item">\n' +
            // // '                            <label class="layui-form-label">业主现场管理机构</label>\n' +
            // // '                            <select name="builderId" id="builderId">\n' +
            // // '                                <option value="">请选择</option>\n' +
            // // '                            </select>\n' +
            // // '                        </div>\n' +
            // // '                        <div class="layui-form-item">\n' +
            // // '                            <label class="layui-form-label">监理现场管理机构</label>\n' +
            // // '                            <select name="supervisorId" id="supervisorId">\n' +
            // // '                                <option value="" >请选择</option>\n' +
            // // '                            </select>\n' +
            // // '                        </div>\n' +
            // // '                        <div class="layui-form-item">\n' +
            // // '                            <label class="layui-form-label">设计现场管理机构</label>\n' +
            // // '                            <select name="designerId" id="designerId">\n' +
            // // '                                <option value="">请选择</option>\n' +
            // // '                            </select>\n' +
            // // '                        </div>\n' +
            // // '                        <div class="layui-form-item">\n' +
            // // '                            <label class="layui-form-label">施工现场管理机构</label>\n' +
            // // '                            <select name="constructorId" id="constructorId">\n' +
            // // '                                <option value="">请选择</option>\n' +
            // // '                            </select>\n' +
            // // '                        </div>\n' +
            // // '                        <div class="layui-form-item">\n' +
            // // '                            <label class="layui-form-label">其他现场管理机构</label>\n' +
            // // '                            <select name="otherId" id="otherId">\n' +
            // // '                                <option value="">请选择</option>\n' +
            // // '                            </select>\n' +
            // // '                        </div>\n' +
            // // '                    </div>\n' +
            // // '                    <div class="layui-form-item">\n' +
            // // '                        <div class="col-xs-12" style="text-align: center;">\n' +
            // // '                            <button class="layui-btn" lay-submit="" lay-filter="demo1"><i class="fa fa-save"></i> 保存</button>&nbsp;&nbsp;&nbsp;\n' +
            // // '                            <button type="reset" class="layui-btn layui-btn-danger"><i class="fa fa-close"></i> 返回</button>\n' +
            // // '                        </div>\n' +
            // // '                    </div>\n' +
            // // '                </form>' +
            // // '',
            // //
            // // yes: function(index, layero){
            // //     var locSel =$("#locSel").val();
            // //     var localeCode =$("#localeCode").val();
            // //     var localeName =$("#localeName").val();
            // //     var localeadd =$("#localeadd").val();
            // //     alert(locSel);
            // //     addlcoale(localeType);
            // // }
            // // ,btn2: function(index, layero){
            // //     layer.close(index);
            // // }

        });




    }
    // var orgs=JSON.parse($("#_orgs").val());
    // // console.log(orgs)
    // for(var i=0;i<orgs.length;i++){
    //     //(业主)建设单位1
    //     //监理单位2
    //     //设计单位4
    //     // 施工单位5
    //     //其他单位12
    //     if(orgs[i].type == 1){
    //         $("#builderId").append($("<option/>").text(orgs[i].name).attr({"value": orgs[i].id}));
    //     }else if(orgs[i].type == 2){
    //         $("#supervisorId").append($("<option/>").text(orgs[i].name).attr({"value": orgs[i].id}));
    //     }else if(orgs[i].type == 4){
    //         $("#designerId").append($("<option/>").text(orgs[i].name).attr({"value": orgs[i].id}));
    //     }else if(orgs[i].type == 5){
    //         $("#constructorId").append($("<option/>").text(orgs[i].name).attr({"value": orgs[i].id}));
    //     }else if(orgs[i].type == 12){
    //         $("#otherId").append($("<option/>").text(orgs[i].name).attr({"value": orgs[i].id}));
    //     }
    // }
    // layui.use(['form', 'layedit', 'laydate'], function(){
    //     var form = layui.form
    //         ,layer = layui.layer
    //         ,layedit = layui.layedit
    //         ,laydate = layui.laydate;
    //
    //     //日期
    //     laydate.render({
    //         elem: '#date'
    //     });
    //     laydate.render({
    //         elem: '#date1'
    //     });
    //     laydate.render({
    //         elem: '#date2'
    //     });
    //
    //     //创建一个编辑器
    //     var editIndex = layedit.build('LAY_demo_editor');
    //
    //     function closWin() {
    //         var index = parent.layer.getFrameIndex(window.name);
    //         parent.layer.close(index);
    //     };
    //     function refreshSub() {
    //         parent.admin_table.ajax.url("{:url('contract/common/datatablesPre?tableName=section')}").load();
    //     }
    //     form.on('select(filter)', function(data){
    //         console.log(data.elem); //得到select原始DOM对象
    //         console.log(data.value); //得到被选中的值
    //         console.log(data.othis); //得到美化后的DOM对象
    //     });
    //     //监听提交
    //     form.on('submit(demo1)', function(data){
    //         console.log($("#addId").val())
    //         console.log(data);
    //         if($("#addId").val() == ''){
    //             console.log($("#addId").val())
    //             $.ajax({
    //                 type: "Post",
    //                 url:"{:url('addoredit')}",
    //                 data:data.field,
    //                 success: function (res) {
    //                     console.log(res)
    //                     if(res.code == 1) {
    //                         refreshSub();
    //                         parent.layer.msg('保存成功！');
    //                         closWin();
    //                     }
    //                 },
    //                 error: function (data) {
    //                     debugger;
    //                 }
    //             })
    //         }else if($("#addId").val() != ''){
    //             $.ajax({
    //                 type: "Post",
    //                 url:"{:url('addoredit')}",
    //                 data:data.field,
    //                 success: function (res) {
    //                     console.log(res)
    //                     if(res.code == 1) {
    //                         refreshSub();
    //                         parent.layer.msg('编辑成功！');
    //                         closWin();
    //                     }
    //                 },
    //                 error: function (data) {
    //                     debugger;
    //                 }
    //             })
    //         }
    //         return false;
    //     });
    //     $('button[type="reset"]').click(function () {
    //         closWin();
    //     })
    // });
    // $.ajax({
    //     type: "GET",
    //     url:"{:url('Contract/getAll')}",
    //     success: function (data) {
    //         $("#contractId").empty();
    //         $(data).each(function () {
    //             // if (secton.ContractId !== null) {
    //             //     if (secton.ContractId === this.id) {
    //             //         $("#contractId").append($("<option/>").text(this.contractName).attr("value", this.id).attr("selected", true));
    //             //     }
    //             //     else {
    //             //         $("#contractId").append($("<option/>").text(this.contractName).attr("value", this.id));
    //             //     }
    //             // }
    //             // else {
    //             $("#contractId").append($("<option/>").text(this.contractName).attr({"value": this.id}));
    //             // }
    //         });
    //     },
    //     error: function (res) {
    //         console.log(res)
    //         debugger;
    //     }
    // })
    //删除
    function secDel(that){
        var id = admin_table.row(".highlight").data()[7];
        layer.confirm('是否删除该标段?', function(index){
            $.ajax({
                url: "{:url('./contract/section/del')}",
                type: "post",
                data: {id:id},
                dataType: "json",
                success: function (res) {
                    console.log(res);
                    if(res.code == 1){
                        layer.msg("删除成功！");
                        admin_table.ajax.url("{:url('contract/common/datatablesPre?tableName=section')}").load();
                    }
                }
            });
            layer.close(index);
        });
    }
</script>
</html>