<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>fengning_main</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="__PUBLIC__/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__PUBLIC__/layui/css/modules/layer/default/layer.css" media="all">
    <link rel="stylesheet" href="__PUBLIC__/font-awesome/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="__PUBLIC__/jquery/jquery.min.js"></script>
    <script type="text/javascript" charset="utf8" src="__PUBLIC__/layui/lay/modules/layer.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js"></script>
    <style type="text/css">
        #path{
            line-height: 30px;
            font-weight: 700;
            border-bottom: 1px solid #000;
        }
        #spanPath{
            display: inline-block;
            float: left;
        }
        #mytable1_wrapper{
            position: relative;
            margin-top: 5px;
        }
        .mybtn{
            position: absolute;
            right: 1%;
            top: 0;
        }
        .float_left{
            float: left;
        }
        .float_left input:hover{
            border-color: #9ac6ff;
        }
        .dataTables_length{
            height: 8px;
            position:absolute;
            bottom: 18px;
            left: 175px;
        }
        #mytable1_wrapper .dataTables_wrapper {
            position: relative;
            clear: both;
            zoom: 1;
            overflow-x: auto;
        }

        #mytable1_wrapper table{
            width: 800px;
        }
        table {
            table-layout:fixed;
        }
        table td{
            word-break:break-all;
        }
        .highlight {
            background: #a58878 !important;
        }

    </style>
<body class="layui-layout-body" style="overflow-y:visible;">
<!--表格-->
<div class="wrapper wrapper-content animated fadeInRight" style="width: 98%;vertical-align: top;padding: 0;margin-top: 20px;margin-left: 20px;text-align: center">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <div class="row">
                <div id="path"><span id="spanPath">合同登记</span><div style="clear: both;"></div></div>
                <div id="mytable1_wrapper">
                    <table id="admin_table" width="100%" class="table table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>标段编码</th>
                            <th>标段名称</th>
                            <th>合同金额（万元）</th>
                            <th>业主单位</th>
                            <th>施工单位</th>
                            <th>设计单位</th>
                            <th>监理单位</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script type="text/javascript">

    var adminId;
    var admin_table = $('#admin_table').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url:"{:url('contract/common/datatablesPre?tableName=section')}"
        },
        dom: '<"mybtn layui-btn layui-btn-sm"><"selectyear"><"myl"l><"float_left"f>tip',
        columns:[
            {
                name: "code"
            },
            {
                name: "name"
            },
            {
                name: "money"
            },
            {
                name: "builder"
            },
            {
                name: "constructor"
            },
            {
                name: "designer"
            },
            {
                name: "supervisor"
            },
            {
                name: "id"
            }
        ],
        columnDefs: [
            {
                searchable: false,
                orderable: false,
                targets: [7],
                render :  function(data,type,row) {
                    adminId = data;
                    var html =  "<a type='button' class='' style='margin-left: 5px;' onclick='secEdit(this)'><i class='fa fa-pencil'></i></a >" ;
                    html += "<a type='button' class='' style='margin-left: 5px;' onclick='secDel(this)'><i class='fa fa-trash'></i></i></a>" ;
                    return html;
                }
            },
        ],
        language: {
            "lengthMenu": "每页_MENU_ 条记录",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "previous": "上一页",
                "next": "下一页"
            }
        }
    });
    $("div.mybtn").html('<div id="xz">新增</div>');
    //变色
    $('#admin_table tbody').on( 'mouseover', 'td', function () {
            $(this).parent("tr").addClass('highlight');
        }).on( 'mouseleave', 'td', function () {
            $(this).parent("tr").removeClass( 'highlight' );
    });
    //新增
    $("#admin_table_wrapper .mybtn").click(function () {
        layer.open({
            type: 2,
            title: '新增标段',
            shadeClose: true,
            area: ['780px', '550px'],
            content: '{:url("add")}',
        });
    })
    //编辑
    function secEdit(that){
        var id = adminId;
        console.log(id)
        $.ajax({
            url: "{:url('./contract/section/getOne')}?id="+id,
            type: "post",
            data: {id:id},
            dataType: "json",
            success: function (res) {
                console.log(res);
                layer.open({
                    type: 2,
                    title: '编辑标段',
                    shadeClose: true,
                    area: ['780px', '550px'],
                    content: '{:url("add")}',
                    success: function(layero, index){
                        var laysrc = layer.getChildFrame('#nameLay', index);
                        var body = layer.getChildFrame('body', index);
                        var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();
                        // console.log(body.html()) //得到iframe页的body内容
                        // console.log(laysrc.html())
                        body.find('input[name="id"]').val(res.id);
                        body.find('input[name="code"]').val(res.code);
                        body.find('input[name="shortName"]').val(res.shortName);
                        body.find('input[name="money"]').val(res.money);
                        body.find('input[name="name"]').val(res.name);
                        body.find('input[name="contract"]').val(res.contract);
                        body.find('input[name="builder"]').val(res.builder);
                        body.find('input[name="supervisor"]').val(res.supervisor);
                        body.find('input[name="designer"]').val(res.designer);
                        body.find('input[name="constructor"]').val(res.constructor);
                        body.find('input[name="other"]').val(res.other);
                    },
                });
            }
        })
    }
    //删除
    function secDel(that){
        layer.confirm('是否删除该合同?', function(index){
            var id = adminId;
            console.log(id)
            $.ajax({
                url: "{:url('./contract/section/del')}",
                type: "post",
                data: {id:id},
                dataType: "json",
                success: function (res) {
                    console.log(res);
                    if(res.code == 1){
                        layer.msg("删除成功！");
                        admin_table.ajax.url("{:url('contract/common/datatablesPre?tableName=section')}").load();
                    }
                }
            });
            layer.close(index);
        });
    }
</script>
</html>