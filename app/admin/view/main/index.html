{include file="../app/public/common_header.html"}
<link rel="stylesheet" href="__WEBSITE__/main/index.css">
      <div data-options="region:'east',title:'管理信息',split:true" style="width:345px;">
            <div id="dd" class="easyui-tabs" style="width:100%;height:100%;border: 0">
                  <div title="属性" style="padding:20px;display:none;">
                        tab1
                  </div>
                  <div title="讨论" style="overflow:auto;padding:20px;display:none;">
                        tab2
                  </div>
                  <div title="附件" style="overflow:auto;padding:20px;display:none;">
                        tab3
                  </div>
                  <div title="二维码" style="overflow:auto;padding:20px;display:none;">
                        tab4
                  </div>
            </div>
      </div>
      <div data-options="region:'west',title:'管理视图',split:true" style="width:200px;"></div>
      <div data-options="region:'center',title:''" class="centent">
            <div class="easyui-layout" data-options="fit:true">
                  <div data-options="region:'center',title:''" style="padding:5px;">
                        <script language="javascript"  for="RealBimOcx" EVENT="OnCurSelModelChanged(strObjName, uObjSubID,   fObjSelX, fObjSelY, fObjSelZ,  fObjBVMinX,fObjBVMinY,fObjBVMinZ,  fObjBVMaxX,fObjBVMaxY,fObjBVMaxZ)" type="text/javascript">
                            /*console.log(uObjSubID);
                            var node = [];
                            var treeObj = $.fn.zTree.getZTreeObj("ztree");
                            var nodes = treeObj.transformToArray(treeObj.getNodes());
                            for(var i = 0;i<nodes.length;i++){
                                if(nodes[i].name == 'Y-Ⅵ-969.30-CZ0+024.000-0+054.000'){
                                    node.push(nodes[i]);
                                    treeObj.checkNode(nodes[i],true);
                                }
                            }
                            creatSelectedZtree(node,uObjSubID);*/

                            RealBimOcx.ExitSubObjFlicker();

                            RealBimOcx.BatchAddSubClrInfoBegin();
                            RealBimOcx.AddSubClrPercent(uObjSubID,1,0x80ffa500);
                            RealBimOcx.BatchAddSubClrInfoEnd();
                            // //设置模型的可见性，0为不可见，1为可见。通过模型id进行关联。
                            // RealBimOcx.SetHugeObjSubValidStateBegin();
                            // RealBimOcx.SetHugeObjSubValidStateInfo(uObjSubID, 1);
                            // RealBimOcx.SetHugeObjSubValidStateEnd();
                            // RealBimOcx.SetAllHugeObjSubValidState(0); //全部不显示


                            //点击树的时候加载
                            //RealBimOcx.SetAllHugeObjSubValidState(0); //全部不显示
                            //RealBimOcx.SetHugeObjSubValidStateBegin();
                            // for(var i = 0;i<arr.length;i++){        //多层关联可见性
                            //RealBimOcx.SetHugeObjSubValidStateInfo(uObjSubID, 1);
                            //}
                            //RealBimOcx.SetHugeObjSubValidStateEnd();

                            //点击表格数据的时候 加载
                            // RealBimOcx.FocusCameraToComponent(uObjSubID,3);


                            //获取一个构件的可见性状态
                            //ULONG uObjSubID:构件ID
                            //返回值表示指定构件的有效性:(0表示构件无效，1表示构件有效）
                            // ULONG GetAHugeObjSubValidState(ULONG uObjSubID);



                            //进入闪烁构件的设置状态
                            //FlickerSwitchTimes:闪烁次数
                            //FlickerInterval：闪烁时间间隔
                            //Alpha0，AlphaAmp0，RGBBlendInfo0，Alpha1，AlphaAmp1，RGBBlendInfo1：两种闪烁状态的透明度，透明度混合系数，以及颜色和颜色混合系数，与AddSubClrInfo()的后三个参数用法相同
                            // void SetSubObjFlickerBegin(LONG FlickerSwitchTimes,LONG FlickerInterval, BYTE Alpha0, BYTE AlphaAmp0, ULONG RGBBlendInfo0, BYTE Alpha1, BYTE AlphaAmp1, ULONG RGBBlendInfo1);

                            // RealBimOcx.SetSubObjFlickerBegin(20,1000,255,255,0xff87ceeb,255,255,0x8000008b);
                            // RealBimOcx.AddFlickerSubObjects(uObjSubID);
                            // RealBimOcx.SetSubObjFlickerEnd();


                            // 设置透明度和颜色：0为全透明，1为不透明
                            //RealBimOcx.BatchAddSubClrInfoBegin();
                            //RealBimOcx.AddSubClrPercent(uObjSubID,0.8,0x80ff0000);
                            //RealBimOcx.BatchAddSubClrInfoEnd();



                            //设置最佳视角
                            // RealBimOcx.SetSuitableCam();
                        </script>
                        <object id="RealBimOcx" classid="CLSID:2CD7E1BE-10B8-4A1C-B908-4FB7D4FD4ABD"  width="100%" height="90%"></object>

                        <script language="javascript"   for="RealBimOcx" EVENT="OnRealBimOcxInited()" type="text/javascript">
                            // RealBimOcx.SwitchBIMSceneSimple("http://192.168.1.58:8008/default.aspx?dir=url_res02&path=","res_fengning_kw_03");

                            //设置服务url
                            RealBimOcx.SwitchBIMSceneSimple("F:\\","res_fengning_kw_03");
                            RealBimOcx.SetSceVersionInfoExt(100, -1, 0, 2000000000);

                            RealBimOcx.CreateAGolFont("CustomFont01","微软雅黑",true,true,14,14,32,1.0,0*64,"");
                            RealBimOcx.CreateAGolFont("CustomFont02","微软雅黑",true,true,12,12,8,1.0,0*64,"");
                        </script>

                        <script language="javascript"   for="RealBimOcx" EVENT="WorkCompleteNotification(CompleteEvent,retError)" type="text/javascript">
                            if(CompleteEvent == "LoadMainScene" && retError==0 ){
                                RealBimOcx.SetAllHugeObjSubValidState(1);
                                //RealBimOcx.SetSceHugeObjVisible(false);
                            }

                            var unitEnginNoId = document.cookie.split(';')[0].split('=')[1];
                            //保存关联模型
                            window.saveModel = function (add_id) {
                                $.ajax({
                                    url: "./addModelPicture",
                                    type: "post",
                                    data: {
                                        id:unitEnginNoId,
                                        picture_id:add_id
                                    },
                                    dataType: "json",
                                    success: function (res) {
                                        layer.msg(res.msg);
                                    }
                                })
                            }
                            //加载模型试图
                            window.loadModel = function (add_id) {
                                $.ajax({
                                    url: "./relevanceModelPicturePreview",
                                    type: "post",
                                    data: {
                                        add_id:add_id
                                    },
                                    dataType: "json",
                                    success: function (res) {
                                        if(res.numberArr==''){
                                            RealBimOcx.SetAllHugeObjSubValidState(0);
                                        }else{
                                            RealBimOcx.SetAllHugeObjSubValidState(0);   //设置模型全部不可见
                                            RealBimOcx.SetHugeObjSubValidStateBegin();  //启用模型可见
                                            RealBimOcx.SetHugeObjSubValidStateInfo(res.number, 1); //设置单个模型可见
                                            RealBimOcx.SetHugeObjSubValidStateEnd();   //停用模型可见
                                            RealBimOcx.FocusCameraToComponent(res.number,1); //3：视角距离
                                            //模型视图闪烁
                                            RealBimOcx.SetSubObjFlickerBegin(3,500,255,255,0xffffff,255,255,0x80ff0000);
                                            RealBimOcx.AddFlickerSubObjects(res.number);
                                            RealBimOcx.SetSubObjFlickerEnd();
                                        }
                                    }
                                })
                            };

                            //取消模型闪烁
                            window.cancelTwinkle = function () {
                                RealBimOcx.ExitSubObjFlicker();
                            }
                            //FlickerSwitchTimes:闪烁次数
                            //FlickerInterval：闪烁时间间隔
                            //Alpha0，AlphaAmp0，RGBBlendInfo0，Alpha1，AlphaAmp1，RGBBlendInfo1：两种闪烁状态的透明度，透明度混合系数，以及颜色和颜色混合系数，与AddSubClrInfo()的后三个参数用法相同
                            // void SetSubObjFlickerBegin(LONG FlickerSwitchTimes,LONG FlickerInterval, BYTE Alpha0, BYTE AlphaAmp0, ULONG RGBBlendInfo0, BYTE Alpha1, BYTE AlphaAmp1, ULONG RGBBlendInfo1);
                        </script>

                        <script for="RealBimOcx" event="UIClicked(eType,uButtonMode)" language='javascript'>
                            function clearOperate() {
                                operateType = "";
                                RealBimOcx.AddAnchorEnd();
                                RealBimOcx.CreateMarkerEnd("", 0, 0, "", true);
                            };


                            switch (eType) {
                                case "ADD_ANCHOR":
                                    clearOperate();
                                    RealBimOcx.AddAnchorBegin(0);//构件锚点开始
                                    break; //添加锚点

                                case "DISP_ANCHOR":
                                    break; //显示锚点
                                case "DISP_TAG":
                                    break;
                                case "MARKER":
                                    clearOperate();
                                    RealBimOcx.CreateMarkerBegin();
                                    break;//添加标注

                                case "CAPTURE":  //快照
                                    RealBimOcx.CreateSnapShootInMem(true, 0, 0, true, true);
                                    break;
                                case "DISP_ISOLATE":
                                    break;
                                case "DISP_HIDE":
                                    break;

                            }
                        </script>
                        <script language="javascript" for="RealBimOcx" EVENT="SnapShootData(strPicData,picWidth,picHeight,strRenData)" type="text/javascript">
                            base64PicData = strPicData;
                            base64RenData = strRenData;
                            //添加快照
                            console.log('test');
                            var img = '<div class="swiper-slide"><img src="data:image/png;base64,'+ base64PicData +'" alt="">'+ Math.floor(Math.random()*10); +'</div>';
                            mySwiper.prependSlide(img);
                        </script>
                  </div>
                  <div data-options="region:'south',title:'协同信息',split:true" style="height:250px;">
                        <div id="tt" class="easyui-tabs" style="width:100%;height:200px;border: 0">
                              <div title="标注" style="display:none;">
                                    tab1
                              </div>
                              <div title="快照" style="overflow:auto;display:none;">
                                    <div class="swiper-container">
                                          <div class="swiper-wrapper" id="swiperWrapper"></div>
                                          <!-- 如果需要导航按钮 -->
                                          <div class="swiper-button-prev"></div>
                                          <div class="swiper-button-next"></div>
                                    </div>
                              </div>
                        </div>
                  </div>
            </div>
      </div>
{include file="../app/public/common_footer.html"}
<script type="text/javascript">
    window.mySwiper = new Swiper ('.swiper-container', {
        nextButton: '.swiper-button-next',
        prevButton: '.swiper-button-prev',
        slidesPerView : 6,
        centeredSlides: false,
        paginationClickable: false,
        spaceBetween: 30,
        loop: true,
    })
    window.addSnapshot = function (base64RenData) {

    }
</script>
</body>
</html>